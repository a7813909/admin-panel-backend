// src/app.ts
    // –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª Express-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ó–¥–µ—Å—å –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –º–∏–¥–ª–≤–∞—Ä—ã, –º–∞—Ä—à—Ä—É—Ç—ã –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫.
    import express, { Request, Response, NextFunction } from 'express';
    import helmet from 'helmet'; // –î–ª—è –±–∞–∑–æ–≤–æ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ HTTP-–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤
    import cors from 'cors';     // –î–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–æ—Å—Ç—É–ø–æ–º –∫ API —Å —Ä–∞–∑–Ω—ã—Ö –¥–æ–º–µ–Ω–æ–≤
    import logger from './utils/logger'; // –ù–∞—à –∫–∞—Å—Ç–æ–º–Ω—ã–π –ª–æ–≥–≥–µ—Ä
    import config from './config';     // –ù–∞—à —Ñ–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
    import prisma from './db';         // –ù–∞—à —ç–∫–∑–µ–º–ø–ª—è—Ä Prisma Client

    // –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä Express-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    const app = express();

    // --- –ë–∞–∑–æ–≤—ã–µ –º–∏–¥–ª–≤–∞—Ä—ã –¥–ª—è "–∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ" –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---
    // Helmet –ø–æ–º–æ–≥–∞–µ—Ç –∑–∞—â–∏—Ç–∏—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –∏–∑ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –≤–µ–±-—É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
    app.use(helmet());

    // CORS (Cross-Origin Resource Sharing)
    // –†–∞–∑—Ä–µ—à–∞–µ—Ç –∏–ª–∏ –∑–∞–ø—Ä–µ—â–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã —Å –¥—Ä—É–≥–∏—Ö –¥–æ–º–µ–Ω–æ–≤.
    // –ò—Å–ø–æ–ª—å–∑—É–µ–º 'config.frontendCorsOrigins', –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º URL –∏–ª–∏ '*'
    app.use(cors({
      origin: config.frontendCorsOrigins,
      credentials: true, // –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –∫—É–∫–∏ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
    }));

    // –ü–∞—Ä—Å–∏–Ω–≥ JSON-—Ç–µ–ª –∑–∞–ø—Ä–æ—Å–æ–≤: –ø–æ–∑–≤–æ–ª—è–µ—Ç Express —á–∏—Ç–∞—Ç—å JSON –∏–∑ request.body
    app.use(express.json());

    // –ü–∞—Ä—Å–∏–Ω–≥ URL-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ–ª –∑–∞–ø—Ä–æ—Å–æ–≤: –¥–ª—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ HTML-—Ñ–æ—Ä–º
    app.use(express.urlencoded({ extended: true }));

    // --- –ú–∏–¥–ª–≤–∞—Ä –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ ---
    // –ö–∞–∂–¥—ã–π –≤—Ö–æ–¥—è—â–∏–π –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞—à–∏–º Winston –ª–æ–≥–≥–µ—Ä–æ–º.
    app.use((req: Request, res: Response, next: NextFunction) => {
      logger.http(`Received request: [${req.method}] ${req.url}`);
      next(); // –ü–µ—Ä–µ–¥–∞–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–ª–µ–¥—É—é—â–µ–º—É –º–∏–¥–ª–≤–∞—Ä—É –∏–ª–∏ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫—É –º–∞—Ä—à—Ä—É—Ç–∞
    });

    // --- –ú–∞—Ä—à—Ä—É—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è ---
    // –ë–∞–∑–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ API
    app.get('/', (req: Request, res: Response) => {
      res.status(200).json({
        message: 'Welcome to admin-panel-backend API! üöÄ',
        environment: process.env.NODE_ENV || 'development',
        version: '1.0.0',
        corsOrigins: config.frontendCorsOrigins, // –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ CORS
      });
    });

    // –¢–µ—Å—Ç–æ–≤—ã–π –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Prisma
    app.get('/test-db', async (req: Request, res: Response, next: NextFunction) => {
        try {
            // –ü—ã—Ç–∞–µ–º—Å—è –ø–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
            // (–¥–∞–∂–µ –µ—Å–ª–∏ —Ç–∞–±–ª–∏—Ü–∞ Users –ø–æ–∫–∞ –ø—É—Å—Ç–∞, –∑–∞–ø—Ä–æ—Å –¥–æ–ª–∂–µ–Ω –ø—Ä–æ–π—Ç–∏)
            const users = await prisma.user.findMany();
            res.json({ message: 'DB connection successful!', users });
            logger.info('Successfully fetched users from DB via /test-db endpoint');
        } catch (error) {
            // –ï—Å–ª–∏ –ø—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –∫ –ë–î, –ª–æ–≥–∏—Ä—É–µ–º –µ–µ –∏ –ø–µ—Ä–µ–¥–∞–µ–º –¥–∞–ª—å—à–µ
            logger.error('Failed to fetch users from DB via /test-db endpoint:', error);
            next(error); // –ü–µ—Ä–µ–¥–∞–µ–º –æ—à–∏–±–∫—É –≤ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫ (–∫–æ—Ç–æ—Ä—ã–π –º—ã –¥–æ–±–∞–≤–∏–º –ø–æ–∑–∂–µ)
        }
    });

    // --- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (–±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ –≤ middlewares/error.middleware.ts) ---
    // app.use(notFoundHandler); // –û–±—Ä–∞–±–æ—Ç–∫–∞ 404 (–Ω–µ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤)
    // app.use(errorHandler);   // –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—à–∏–±–æ–∫

    // –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ–º Express-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ server.ts
    export default app;